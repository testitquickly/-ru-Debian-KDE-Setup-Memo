Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2022-02-23T00:32:25+02:00

====== Как назначить root владельцем каталога (или диска) ======

Как назначить пользователя 'root' владельцем каталога '/media/astenix/WesternDigital4T/', 
* и запретить всем пользователям удалять из этого каталога файлы (например, чтобы случайно не удалилось что-нибудь)
* но дать возможность пользователю 'astenix' заходить в этот каталог и запускать файлы на исполнение (например, чтобы видео могло проигрываться)

РЕШЕНИЕ

1. назначим пользователя 'root' владельцем каталога '/media/astenix/WesternDigital4T/', 
2. а доступ к чтению файлов дадим группе пользователей 'sudo', в которую будет входить оба пользователя, 'astenix' и 'root'
3. и установим юзерам этой группы права только на чтение файлов из этого каталога,
4. и обязательно установим sticky bit на каталог (это предотвращает удаление файлов в каталоге пользователями, ими не владеющими. Для защиты содержимого файла в каталоге, в который разрешена запись всем, например, /tmp, или в каталоге, в который разрешена запись некоторой группе, нужно не только снять право записи в файл, но и установить бит sticky bit на каталог. В противном случае любой пользователь, имеющий право записи в этот каталог, может удалить этот файл и создать новый с тем же именем и с любым содержимым). t-атрибут читается так: владелец имеет все права, группа - чтение, остальные не имееют никаких прав.

Это будет означать, что пользователь 'astenix' 
* не сможет что-либо записать в каталог '/media/astenix/WesternDigital4T/',
* не сможет удалять что-либо из каталога '/media/astenix/WesternDigital4T/',
* сможет копировать всё, что угодно из каталога '/media/astenix/WesternDigital4T/' и вставить в свои каталоги, и скопированные файлы и папки будут автоматически снабжены полными правами юзера 'astenix' (очень удобно!),
* но если пользователь 'root' скопирует к себе в каталог '/media/astenix/WesternDigital4T/' какие-то файлы от юзера 'astenix', то они будут принадлежать юзеру 'astenix', а это означает, что 'astenix' сможет их открыть И ИЗМЕНИТЬ прямо в каталоге '/media/astenix/WesternDigital4T/', потому что оба юзера находятся в одной группе.

ВЫПОЛНЕНИЕ
1
убедиться в том, что нужный каталог существует. Но учесть, что в любом случае дальше будем указывать полный путь к каталогу (/media/astenix/WesternDigital4T/), чтобы избежать ошибок:

'''
cd /media/astenix/WesternDigital4T/
ls
'''


2
убедиться в том, что есть группа sudo (она должна быть по-умолчанию, но все-таки)

3
убедиться в том, что в группе 'sudo' есть оба пользователя, 'root' и 'astenix'

4
''su root''
<ввести пароль для root>
Две команды, которые выполняются последовательно (выполняются долго):
'''
chown root:sudo -R /media/astenix/WesternDigital4T/ 
chmod 1750 -R /media/astenix/WesternDigital4T/
'''


Теперь ситуация такая:
* добавлять файлы в каталог /media/astenix/WesternDigital4T/ может только пользователь 'root',
* новые файлы пользователь 'root' берёт у пользователя 'astenix',
* владельцем этих файлов остаётся 'astenix',
* но только 'root' будет вправе удалять эти файлы,
* однако 'astenix' сможет 
	* копировать эти файлы к себе (и они на новом месте будут автоматически обретать права 'astenix')
* открывать эти файлы на редактирование, изменять их содержимое и СОХРАНЯТЬ изменения.

Это нестрашно в случае, если речь идет о видеофайлах -- их можно открывать на чтение/выполнение, но там нечего редактировать, кроме данных о медиафайле. Это не опасно, но надо понимать, что запрещено только удаление файлов, но не их изменение. 

Чтобы этот момент вообще запретить, нужно каждый раз после добавления новых файлов выполнять команду '''chown root:sudo -R /media/astenix/WesternDigital4T/''', ну или более точно указывать названия файлов, но это явно морочно.

--------------------
@user @folders 	
