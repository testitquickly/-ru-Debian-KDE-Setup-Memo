Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2022-04-24T22:26:13+03:00

====== Установить русские шрифты для LaTeX ======

Есть вероятность, что вся эта глава не нужна, потому что тут обсуждается способ установки русских шрифтов, который происходит из 2004-го года, пакет «PSCyr» — варезный, он заморожен, развития и поддержки больше не будет. Когда-то он реально помогал, а сегодня ситуация со шрифтами изменилась, кириллица в LaTeX будет и без этого пакета. 

Для управления шрифтами надо  перейти на XeLaTex - https://ru.wikipedia.org/wiki/XeTeX - это другой движок для рендеринга документов, и переход на него проходит по-разному. Какие-то команды из LaTeX там не работают, какие-то работают не так, как ожидается, поэтому стилевой файл надо создавать с нуля. Поначалу это раздражает, но потом кажется странным переходить обратно.

Но если надо, то вот.

==== Скачать и распаковать PSCyr ====
Ранее эти два архива находились на ftp://ftp.vsu.ru/pub/tex/font-packs/pscyr/0.4d-beta/ — ныне этот сервер ненавидит всех анонимаусов.

		Теперь они находятся на
		1. http://www.tex.uniyar.ac.ru/package/fonts/pscyr/0.4d-beta9/pscyr-0.4-beta9exp2-tex.tar.gz
		2. http://www.tex.uniyar.ac.ru/package/fonts/pscyr/0.4d-beta9/pscyr-0.4-beta9exp2-type1.tar.gz
		или с
		1. http://alice.saske.sk/files/PSCyr-0.4-beta9-tex.tar.gz
		2. http://alice.saske.sk/files/PSCyr-0.4-beta9-type1.tar.gz

Выполним одним движением сразу несколько команд последовательно:

''mkdir /tmp/latex_fonts/ && cd /tmp/latex_fonts/ && wget ''[[http://www.tex.uniyar.ac.ru/package/fonts/pscyr/0.4d-beta9/pscyr-0.4-beta9exp2-tex.tar.gz|''http://www.tex.uniyar.ac.ru/package/fonts/pscyr/0.4d-beta9/pscyr-0.4-beta9exp2-tex.tar.gz'']]'' && wget ''[[http://www.tex.uniyar.ac.ru/package/fonts/pscyr/0.4d-beta9/pscyr-0.4-beta9exp2-type1.tar.gz|''http://www.tex.uniyar.ac.ru/package/fonts/pscyr/0.4d-beta9/pscyr-0.4-beta9exp2-type1.tar.gz'']]'' && tar -xzf pscyr-0.4-beta9exp2-tex.tar.gz && tar -xzf pscyr-0.4-beta9exp2-type1.tar.gz && cd PSCyr/ && echo 'Done!'''

В итоге мы находимся в новом каталоге /tmp/latex_fonts/PSCyr/.

==== Создать переменную DEST-DIR ====
Установка шрифтов делается с использованием переменных, и возможна
		1. для юзера — определяется содержимым $TEXMFHOME
		2. для всей системы (root) — определяется содержимым $TEXMFLOCAL

Дальновиднее использовать шрифты глобально, поэтому далее погнали под root.

''su''

Cодержимое переменной DEST-DIR будет идентично содержимому латэчевской переменной $TEXMFLOCAL.

Для порядка сперва проверим содержимое $TEXMFLOCAL:

''kpsewhich -expand-var='$TEXMFLOCAL'''

Правильный ответ /home/LaTeX/texmf-local. Иначе алярм.

==== Под root присвоить переменной DEST-DIR нужное значение ====
и сразу проверить, всё ли прошло гладко:

''DEST_DIR='/home/LaTeX/texmf-local' && echo $DEST_DIR''

Правильный ответ /home/LaTeX/texmf-local. Иначе алярм.

==== Создать новые каталоги (пустые) для русских шрифтов ====
Из-под root одной командой:

''mkdir -p $DEST_DIR/fonts/{afm,tfm,type1,vf}/public/pscyr/ && mkdir -p $DEST_DIR/fonts/{enc,map}/dvips/pscyr/ && mkdir -p $DEST_DIR/fonts/map/dvipdfm/pscyr/ && mkdir -p $DEST_DIR/tex/latex/pscyr/ && mkdir -p $DEST_DIR/doc/fonts/pscyr/ && echo 'Done!'''

==== Перенести новые файлы в новые каталоги ====
Мы всё ещё находимся в /tmp/latex_fonts/PSCyr/ под root.

Из-под root одной командой:

''cp fonts/afm/public/pscyr/* $DEST_DIR/fonts/afm/public/pscyr/ && cp fonts/tfm/public/pscyr/* $DEST_DIR/fonts/tfm/public/pscyr/ && cp fonts/type1/public/pscyr/* $DEST_DIR/fonts/type1/public/pscyr/ && cp fonts/vf/public/pscyr/* $DEST_DIR/fonts/vf/public/pscyr/ && cp dvips/pscyr/*.enc $DEST_DIR/fonts/enc/dvips/pscyr/ && cp dvips/pscyr/*.map $DEST_DIR/fonts/map/dvips/pscyr/ && cp dvipdfm/base/*.map $DEST_DIR/fonts/map/dvipdfm/pscyr/ && cp tex/latex/pscyr/* $DEST_DIR/tex/latex/pscyr/ && cp ChangeLog $DEST_DIR/doc/fonts/pscyr/ && cp LICENSE $DEST_DIR/doc/fonts/pscyr/ && cp manifest.txt $DEST_DIR/doc/fonts/pscyr/ && cp doc/PROBLEMS $DEST_DIR/doc/fonts/pscyr/ && cp doc/fonts-ex.tex $DEST_DIR/doc/fonts/pscyr/ && echo 'Done!'''

Каталог PSCyr можно куда-нибудь переместить/сохранить. Если оставить как есть, то он будет существовать в /tmp/ до первого выключения компьютера.

=== Перекодировать файл doc/README ===
из старого (и доброго) KOI8-R в современный UTF8. А то вдруг захочется его прочитать.

''iconv -f KOI8-R -t UTF8 < doc/README.koi > $DEST_DIR/doc/fonts/pscyr/README.utf8 && echo 'Done!'''

==== Принудить систему учитывать новые шрифты ====
Перейти под root.

''texhash && updmap-sys --enable Map=pscyr.map && mktexlsr && echo 'Done!'''

Если не будет тревожных сообщений, то всё, русские шрифты из пакета PSCYR установлены.
    
Можно выйти из-под root.
    
''exit''

==== Ещё раз обновить кэш шрифтов ====

''sudo fc-cache -fsv && echo 'Done!'''
    
Нет указа о том, что теперь надо перелогиниться, но — не помешает.

==== Подключить русский шрифт в документах LaTeX ====
Открыть Kile, создать проект любого типа, в его предусловиях (в настройках оформления перед '\begin{document}') вписать всё нижеследующее и скомпилировать pdf c произвольным «русским по-белому» текстом inside.

'''
% использую многоязычность и объявляю русский язык
% главным (от этого зависит грамотность расстановки
% переносов по всему документу).
% !!! НЕЛЬЗЯ менять местами указание пакетов!!!
% Иначе начнутся проблемы с кодировкой в документе.
% в частности, bibtex сойдет с ума. А после перестановки
% указания пакетов надо будет удалить файл
% Project.bbl (в нем составляется и хранится
% список цитируемой литературы).
\usepackage[english,russian]{babel}

% указание внутренней кодировки LaTeX для русских (вместе с англ) шрифтов
\usepackage[T2A]{fontenc}

% пакет русских шрифтов
\usepackage{pscyr}

% Если не устраивает шрифт, который используется в pscyr
% по умолчанию (шрифт с засечками — Антиква, рубленый
% шрифт — Букварная, шрифт пишущей машинки — ER Курьер),
% следует поставить в преамбулу, например, команду:
% коды взяты из файла /texmf/tex/latex/pscyr/pscyr.sty или /home/LaTeX/texmf-local/tex/latex/pscyr/
\renewcommand{\rmdefault}{fsv}

% заголовки не жирные
% практически норм, тот же opensans, но не бледно,
% и заголовки ЖИРНЫЕ
\usepackage{erewhon}

% грубый хак, назначить основным шрифтом с засечками
рубленую вердану.
\renewcommand{\rmdefault}{fcp}
\renewcommand{\sfdefault}{ftx}
\renewcommand{\ttdefault}{cmtt}
'''

--------------------
@fonts @LaTeX 
